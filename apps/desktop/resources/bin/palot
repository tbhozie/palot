#!/usr/bin/env bash
#
# palot — Open the installed Palot desktop application.
#
# This script is bundled inside the Palot.app package and symlinked
# to /usr/local/bin/palot by the "Install CLI Command" action.
#
# Usage:
#   palot              Open Palot (or focus existing window)
#   palot /path/to/dir Open Palot with a specific project directory

set -euo pipefail

case "$(uname -s)" in
	Darwin)
		# Resolve the .app bundle — this script lives at
		# Palot.app/Contents/Resources/bin/palot
		SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
		APP_BUNDLE="$(cd "$SCRIPT_DIR/../.." && pwd)"

		if [ $# -gt 0 ]; then
			open -a "$APP_BUNDLE" --args "$@"
		else
			open -a "$APP_BUNDLE"
		fi
		;;
	Linux)
		# On Linux the binary is typically at a known location
		SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
		ELECTRON_BIN="$(cd "$SCRIPT_DIR/.." && pwd)/palot"

		if [ -x "$ELECTRON_BIN" ]; then
			exec "$ELECTRON_BIN" "$@"
		else
			# Fallback: try system PATH
			echo "Error: Could not find Palot binary at $ELECTRON_BIN" >&2
			echo "Try launching from your application menu instead." >&2
			exit 1
		fi
		;;
	*)
		echo "Error: Unsupported platform $(uname -s)" >&2
		echo "On Windows, use 'palot.cmd' instead." >&2
		exit 1
		;;
esac
